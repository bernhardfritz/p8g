#include "p8g_typography.h"

#include <string.h>

#include "p8g.h"

#define A "     " \
          "  *  " \
          " * * " \
          "*   *" \
          "*   *" \
          "*****" \
          "*   *" \
          "*   *" \
          "     "
#define B "     " \
          "**** " \
          "*   *" \
          "*   *" \
          "**** " \
          "*   *" \
          "*   *" \
          "**** " \
          "     "
#define C "     " \
          " *** " \
          "*   *" \
          "*    " \
          "*    " \
          "*    " \
          "*   *" \
          " *** " \
          "     "
#define D "     " \
          "**** " \
          "*   *" \
          "*   *" \
          "*   *" \
          "*   *" \
          "*   *" \
          "**** " \
          "     "
#define E "     " \
          "*****" \
          "*    " \
          "*    " \
          "**** " \
          "*    " \
          "*    " \
          "*****" \
          "     "
#define F "     " \
          "*****" \
          "*    " \
          "*    " \
          "**** " \
          "*    " \
          "*    " \
          "*    " \
          "     "
#define G "     " \
          " ****" \
          "*    " \
          "*    " \
          "*    " \
          "*  **" \
          "*   *" \
          " ****" \
          "     "
#define H "     " \
          "*   *" \
          "*   *" \
          "*   *" \
          "*****" \
          "*   *" \
          "*   *" \
          "*   *" \
          "     "
#define I "     " \
          " *** " \
          "  *  " \
          "  *  " \
          "  *  " \
          "  *  " \
          "  *  " \
          " *** " \
          "     "
#define J "     " \
          "    *" \
          "    *" \
          "    *" \
          "    *" \
          "    *" \
          "*   *" \
          " *** " \
          "     "
#define K "     " \
          "*   *" \
          "*  * " \
          "* *  " \
          "**   " \
          "* *  " \
          "*  * " \
          "*   *" \
          "     "
#define L "     " \
          "*    " \
          "*    " \
          "*    " \
          "*    " \
          "*    " \
          "*    " \
          "*****" \
          "     "
#define M "     " \
          "*   *" \
          "** **" \
          "* * *" \
          "* * *" \
          "*   *" \
          "*   *" \
          "*   *" \
          "     "
#define N "     " \
          "*   *" \
          "*   *" \
          "**  *" \
          "* * *" \
          "*  **" \
          "*   *" \
          "*   *" \
          "     "
#define O "     " \
          " *** " \
          "*   *" \
          "*   *" \
          "*   *" \
          "*   *" \
          "*   *" \
          " *** " \
          "     "
#define P "     " \
          "**** " \
          "*   *" \
          "*   *" \
          "**** " \
          "*    " \
          "*    " \
          "*    " \
          "     "
#define Q "     " \
          " *** " \
          "*   *" \
          "*   *" \
          "*   *" \
          "* * *" \
          "*  * " \
          " ** *" \
          "     "
#define R "     " \
          "**** " \
          "*   *" \
          "*   *" \
          "**** " \
          "* *  " \
          "*  * " \
          "*   *" \
          "     "
#define S "     " \
          " *** " \
          "*   *" \
          "*    " \
          " *** " \
          "    *" \
          "*   *" \
          " *** " \
          "     "
#define T "     " \
          "*****" \
          "  *  " \
          "  *  " \
          "  *  " \
          "  *  " \
          "  *  " \
          "  *  " \
          "     "
#define U "     " \
          "*   *" \
          "*   *" \
          "*   *" \
          "*   *" \
          "*   *" \
          "*   *" \
          " *** " \
          "     "
#define V "     " \
          "*   *" \
          "*   *" \
          "*   *" \
          "*   *" \
          "*   *" \
          " * * " \
          "  *  " \
          "     "
#define W "     " \
          "*   *" \
          "*   *" \
          "*   *" \
          "* * *" \
          "* * *" \
          "** **" \
          "*   *" \
          "     "
#define X "     " \
          "*   *" \
          "*   *" \
          " * * " \
          "  *  " \
          " * * " \
          "*   *" \
          "*   *" \
          "     "
#define Y "     " \
          "*   *" \
          "*   *" \
          " * * " \
          "  *  " \
          "  *  " \
          "  *  " \
          "  *  " \
          "     "
#define Z "     " \
          "*****" \
          "    *" \
          "   * " \
          "  *  " \
          " *   " \
          "*    " \
          "*****" \
          "     "
#define UNKNOWN "     " \
                "*****" \
                "*   *" \
                "*   *" \
                "*   *" \
                "*   *" \
                "*   *" \
                "*****" \
                "     "
static const char* CHARSET[] = {
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    UNKNOWN,
    "  "
    "  "
    "  "
    "  "
    "  "
    "  "
    "  "
    "  "
    "  ",
    " "
    "*"
    "*"
    "*"
    "*"
    "*"
    " "
    "*"
    " ",
    "   "
    "* *"
    "* *"
    "   "
    "   "
    "   "
    "   "
    "   "
    "   ",
    "     "
    " * * "
    " * * "
    "*****"
    " * * "
    "*****"
    " * * "
    " * * "
    "     ",
    "  *  "
    " *** "
    "* * *"
    "* *  "
    " *** "
    "  * *"
    "* * *"
    " *** "
    "  *  ",
    "     "
    "** * "
    "** * "
    "  *  "
    "  *  "
    " * **"
    " * **"
    "     ",
    "     "
    " **  "
    "*  * "
    "*  * "
    " **  "
    "*  * "
    "*   *"
    " ****"
    "     ",
    "  "
    " *"
    "* "
    "  "
    "  "
    "  "
    "  "
    "  "
    "  ",
    "   "
    "  *"
    " * "
    "*  "
    "*  "
    "*  "
    " * "
    "  *"
    "   ",
    "   "
    "*  "
    " * "
    "  *"
    "  *"
    "  *"
    " * "
    "*  "
    "   ",
    "     "
    "  *  "
    "* * *"
    " *** "
    "  *  "
    " *** "
    "* * *"
    "  *  "
    "     ",
    "     "
    "     "
    "  *  "
    "  *  "
    "*****"
    "  *  "
    "  *  "
    "     "
    "     ",
    " "
    " "
    " "
    " "
    " "
    " "
    " "
    "*"
    "*",
    "     "
    "     "
    "     "
    "     "
    "*****"
    "     "
    "     "
    "     "
    "     ",
    " "
    " "
    " "
    " "
    " "
    " "
    " "
    "*"
    " ",
    "   "
    "  *"
    "  *"
    " * "
    " * "
    " * "
    "*  "
    "*  "
    "   ",
    "     "
    " *** "
    "*   *"
    "*  **"
    "* * *"
    "**  *"
    "*   *"
    " *** "
    "     ",
    "     "
    "  *  "
    " **  "
    "  *  "
    "  *  "
    "  *  "
    "  *  "
    " *** "
    "     ",
    "     "
    " *** "
    "*   *"
    "    *"
    "  ** "
    " *   "
    "*    "
    "*****"
    "     ",
    "     "
    "*****"
    "    *"
    "   * "
    "  ** "
    "    *"
    "*   *"
    " *** "
    "     ",
    "     "
    "   * "
    "  ** "
    " * * "
    "*  * "
    "*****"
    "   * "
    "   * "
    "     ",
    "     "
    "*****"
    "*    "
    "**** "
    "    *"
    "    *"
    "*   *"
    " *** "
    "     ",
    "     "
    "  ***"
    " *   "
    "*    "
    "**** "
    "*   *"
    "*   *"
    " *** "
    "     ",
    "     "
    "*****"
    "    *"
    "   * "
    "  *  "
    " *   "
    " *   "
    " *   "
    "     ",
    "     "
    " *** "
    "*   *"
    "*   *"
    " *** "
    "*   *"
    "*   *" 
    " *** "
    "     ",
    "     "
    " *** "
    "*   *"
    "*   *"
    " ****"
    "    *"
    "   * "
    "***  "
    "     ",
    " "
    " "
    "*"
    " "
    " "
    " "
    " "
    "*"
    " ",
    " "
    " "
    "*"
    " "
    " "
    " "
    " "
    "*"
    "*",
    "    "
    "   *"
    "  * "
    " *  "
    "*   "
    " *  "
    "  * "
    "   *"
    "    ",
    "     "
    "     "
    "     "
    "*****"
    "     "
    "*****"
    "     "
    "     "
    "     ",
    "    "
    "*   "
    " *  "
    "  * "
    "   *"
    "  * "
    " *  "
    "*   "
    "    ",
    "     "
    " *** "
    "*   *"
    "   * "
    "  *  "
    "  *  "
    "     "
    "  *  "
    "     ",
    "     "
    " *** "
    "*   *"
    "*   *"
    "* * *"
    "** **"
    "* *  "
    "*   *"
    " *** "
    "     ",
    A,
    B,
    C,
    D,
    E,
    F,
    G,
    H,
    I,
    J,
    K,
    L,
    M,
    N,
    O,
    P,
    Q,
    R,
    S,
    T,
    U,
    V,
    W,
    X,
    Y,
    Z,
    "   "
    " **"
    "*  "
    "*  "
    "*  "
    "*  "
    "*  "
    " **"
    "   ",
    "   "
    "*  "
    "*  "
    " * "
    " * "
    " * "
    "  *"
    "  *"
    "   ",
    "   "
    "** "
    "  *"
    "  *"
    "  *"
    "  *"
    "  *"
    "** "
    "   ",
    "     "
    "  *  "
    " * * "
    "*   *"
    "     "
    "     "
    "     "
    "     "
    "     ",
    "     "
    "     "
    "     "
    "     "
    "     "
    "     "
    "     "
    "*****"
    "     ",
    "  "
    "* "
    " *"
    "  "
    "  "
    "  "
    "  "
    "  "
    "  ",
    A,
    B,
    C,
    D,
    E,
    F,
    G,
    H,
    I,
    J,
    K,
    L,
    M,
    N,
    O,
    P,
    Q,
    R,
    S,
    T,
    U,
    V,
    W,
    X,
    Y,
    Z,
    "   "
    "  *"
    " * "
    " * "
    "*  "
    " * "
    " * "
    "  *"
    "   ",
    " "
    "*"
    "*"
    "*"
    "*"
    "*"
    "*"
    "*"
    " ",
    "   "
    "*  "
    " * "
    " * "
    "  *"
    " * "
    " * "
    "*  "
    "   ",
    "    "
    "    "
    "    "
    " * *"
    "* * "
    "    "
    "    "
    "    "
    "    ",
};
#undef A
#undef B
#undef C
#undef D
#undef E
#undef F
#undef G
#undef H
#undef I
#undef J
#undef K
#undef L
#undef M
#undef N
#undef O
#undef P
#undef Q
#undef R
#undef S
#undef T
#undef U
#undef V
#undef W
#undef X
#undef Y
#undef Z
#undef UNKNOWN

static const int TEXT_SIZE = 9;

static int draw_char(char c, float x, float y) {
    p8g_push();
    p8g_translate(x, y);
    const char* str = CHARSET[c % sizeof(CHARSET)];
    size_t len = strlen(str);
    int columns = len / TEXT_SIZE;
    for (int i = 0; i < len; i++) {
        if (str[i] == ' ') {
            continue;
        }
        p8g_rect(i % columns, i / columns, 1, 1);
    }
    p8g_pop();
    return columns;
}

void p8g_text(const char* str, float x, float y) {
    p8g_push();
    p8g_no_stroke();
    const char* c = str;
    float dx = 0.f;
    float dy = 0.f;
    while (*c) {
        if (*c == '\n') {
            dx = 0.f;
            dy += TEXT_SIZE + 1;
            c++;
            continue;
        }
        dx += draw_char(*c++, x + dx, y - dy - TEXT_SIZE) + 1;
    }
    p8g_pop();
}